"use strict";MetronicApp.controller("DashboardController",["$rootScope","$scope","$http","$timeout","$location","Restangular",function(a,b,c,d,e,f){b.$on("$viewContentLoaded",function(){Metronic.initAjax(),a.settings.layout.pageSidebarClosed=!1}),c.defaults.useXDomain=!0,c.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",c.defaults.headers.post["Access-Control-Allow-Origin"]="*",c.defaults.headers.post["Access-Control-Allow-Headers"]="Origin, Accept,AUTH_TOKEN",c.defaults.headers.post["Access-Control-Allow-Methods"]="POST, GET, OPTIONS, HEAD, PUT",delete c.defaults.headers.common["X-Requested-With"],b.show=!1,b.missed=0,b.answered=0,b.voiceMail=0,b.created_to=0,b.created_from=0,b.form="days",b.current=!0,b.cdrDetail=[],b.cdrDetailInDates=[],b.TotalCalls=0,b.auth_Id="",b.dateBlock=!1,b.account_Id="",b.date_from="",b.date_to="",b.credit=0,b.numbers=[],b.phnNumbers="all",b.cdrResponseArray=[],b.voiceMailIds=[],b.typeOptions=[{name:"Days",value:"days",selected:"selected"},{name:"Weeks",value:"weeks"},{name:"Months",value:"month"}],b.phone_numbersOptions=[{name:"All Plans",value:"all",selected:"selected"}],b.testData=[{id:"201506-424c2a00-098e-11e5-8de5-25922553de2e",call_id:"424c2a00-098e-11e5-8de5-25922553de2e",caller_id_number:"9814061916",caller_id_name:"9814061916",callee_id_number:"09878597619",callee_id_name:"09878597619",duration_seconds:"86",billing_seconds:"69",timestamp:63600513516,hangup_cause:"NORMAL_CLEARING",other_leg_call_id:"2beab70503ea58dd0bd2c1a06e72d78b @103.28.241.102:5060",owner_id:"",to:"09878597619@103.28.241.102",from:"9814061916@103.28.241.102",direction:"outbound",request:"09878597619@103.28.241.102",authorizing_id:"",cost:0,dialed_number:"09878597619",calling_from:"9814061916",datetime:"2015-06-01 01:18:36",unix_timestamp:1433294316,call_type:"",rate:0,rate_name:""}],b.getCredits=function(){b.account_Id=localStorage.getItem("acc"),b.auth_Id=localStorage.getItem("auth");var a=f.one("accounts/"+b.account_Id+"/braintree/credits"),c="";a.get(c,{"X-AUTH-TOKEN":b.auth_Id}).then(function(a){b.credit=a.data.amount})},b.getPhoneNumbers=function(){b.phone_numbersOptions=[{name:"All Plans",value:"all",selected:"selected"}],b.account_Id=localStorage.getItem("acc"),b.auth_Id=localStorage.getItem("auth");var a=f.one("accounts/"+b.account_Id+"/phone_numbers"),c="";a.get(c,{"X-AUTH-TOKEN":b.auth_Id}).then(function(a){for(var c=a.data.numbers,d=Object.keys(c),e=0;e<=d.length-1;e++)b.phone_numbersOptions.push({name:d[e],value:d[e]})})},b.getDTnumbers=function(){var a=localStorage.getItem("acc");b.DTNumbers=[],c({url:"php-script/getNumbers.php",method:"GET",params:{id:a}}).success(function(a,c){for(var d=0;d<a.length;d++)b.DTNumbers.push(a[d].dt_number);b.DTNumbers.length>0?b.AllDtNums=b.DTNumbers.join(","):b.AllDtNums=""})},b.getVoiceMails=function(){b.account_Id=localStorage.getItem("acc"),b.auth_Id=localStorage.getItem("auth");for(var a=[],c=0;c<b.voiceMailIds.length;c++){var d=f.one("accounts/"+b.account_Id+"/vmboxes/"+b.voiceMailIds[c]),e="";d.get(e,{"X-AUTH-TOKEN":b.auth_Id}).then(function(c){var d=c.data.messages;new Date(b.date_from).getTime()/1e3,new Date(b.date_to).getTime()/1e3;if(d.length>0){for(var e=0;e<d.length;e++){var f=d[e].timestamp-62167219200,g=new Date(1e3*f),h=g.toString().substr(0,15),i=h.split(" ");a.push(i)}for(var e=0;e<b.cdrDetail.length;e++)for(var j=0;j<a.length;j++)b.cdrDetail[e].date[0]==a[j][0]&&b.cdrDetail[e].date[1]==a[j][1]&&b.cdrDetail[e].date[2]==a[j][2]&&b.cdrDetail[e].date[3]==a[j][3]&&(b.cdrDetail[e].voice_mail=b.cdrDetail[e].voice_mail+1)}})}},b.getVoiceMailBoxes=function(){b.account_Id=localStorage.getItem("acc"),b.auth_Id=localStorage.getItem("auth"),b.voiceMailIds=[];var a=f.one("accounts/"+b.account_Id+"/vmboxes"),c="";a.get(c,{"X-AUTH-TOKEN":b.auth_Id}).then(function(a){for(var c=a.data,d=0;d<c.length;d++)b.voiceMailIds.push(c[d].id);b.getVoiceMails()})},b.getcdrs=function(){b.getPhoneNumbers(),b.getDTnumbers(),b.getCredits(),1==b.dateBlock&&(b.date_from=document.getElementById("date_from").value,b.date_to=document.getElementById("date_to").value),b.dateBlock=!1;var a=new Date(b.date_from).getTime()/1e3,c=new Date(b.date_to).getTime()/1e3;c+=8e5,a+=62167219200,c+=62167219200,b.auth_Id=localStorage.getItem("auth"),b.account_Id=localStorage.getItem("acc"),b.cdrDetail=[],b.cdrDetailDates=[];var d={auth_token:b.auth_Id,created_from:a,created_to:c},e=f.one("accounts/"+b.account_Id+"/cdrs");e.data=d,e.get(d,{"X-AUTH-TOKEN":b.auth_Id}).then(function(a){b.cdrResponseArray=a.data,b.created_from=b.date_from,b.created_to=b.date_to,b.TotalCalls=0;var c=b.created_from,d=new Date(b.created_to),e=new Date(c);for(b.between=[],b.callsIn24Hrs=[];d>=e;)b.between.push(new Date(e)),e.setDate(e.getDate()+1);for(var f=0;f<b.between.length;f++){var g=new Date(b.between[f]);g.setHours(0,0,0,0);var h=g.toString().substr(0,15);if(b.cdrResponseArray.length>0){for(var i=0;i<b.cdrResponseArray.length;i++){var j=b.cdrResponseArray[i].datetime.substr(0,10),k=new Date(j);k.setHours(0,0,0,0);var l=k.toString().substr(0,15);if("all"==b.phnNumbers){if(h==l){var m=b.cdrDetailDates.indexOf(l);if(m>-1){if(""!=b.cdrResponseArray[i].other_leg_call_id&&b.cdrResponseArray[i].other_leg_call_id.indexOf("@")>-1){b.cdrResponseArray[i].callee_id_number.match(/[a-z]/i)||"outbound"==b.cdrResponseArray[i].direction&&("NORMAL_CLEARING"==b.cdrResponseArray[i].hangup_cause&&(b.cdrDetail[m].call_answered=b.cdrDetail[m].call_answered+1,b.TotalCalls=b.TotalCalls+1),("ORIGINATOR_CANCEL"==b.cdrResponseArray[i].hangup_cause||"UNALLOCATED_NUMBER"==b.cdrResponseArray[i].hangup_cause||"CALL_REJECTED"==b.cdrResponseArray[i].hangup_cause||"NO_ANSWER"==b.cdrResponseArray[i].hangup_cause||"NO_USER_RESPONSE"==b.cdrResponseArray[i].hangup_cause||"RECOVERY_ON_TIME_EXPIRE"==b.cdrResponseArray[i].hangup_cause)&&(b.cdrDetail[m].call_missed=b.cdrDetail[m].call_missed+1,b.TotalCalls=b.TotalCalls+1),"OUTGOING_CALL_BARRED"==b.cdrResponseArray[i].hangup_cause&&(b.cdrDetail[m].outbound_call=b.cdrDetail[m].outbound_call+1,b.TotalCalls=b.TotalCalls+1))}}else""!=b.cdrResponseArray[i].other_leg_call_id&&b.cdrResponseArray[i].other_leg_call_id.indexOf("@")>-1&&(b.cdrResponseArray[i].callee_id_number.match(/[a-z]/i)||"outbound"==b.cdrResponseArray[i].direction&&("NORMAL_CLEARING"==b.cdrResponseArray[i].hangup_cause&&(b.cdrDetail.unshift({date:h,call_answered:1,call_missed:0,voice_mail:0,outbound_call:0}),b.TotalCalls=b.TotalCalls+1),("ORIGINATOR_CANCEL"==b.cdrResponseArray[i].hangup_cause||"UNALLOCATED_NUMBER"==b.cdrResponseArray[i].hangup_cause||"CALL_REJECTED"==b.cdrResponseArray[i].hangup_cause||"NO_ANSWER"==b.cdrResponseArray[i].hangup_cause||"NO_USER_RESPONSE"==b.cdrResponseArray[i].hangup_cause||"RECOVERY_ON_TIME_EXPIRE"==b.cdrResponseArray[i].hangup_cause)&&(b.cdrDetail.unshift({date:h,call_answered:0,call_missed:1,voice_mail:0,outbound_call:0}),b.TotalCalls=b.TotalCalls+1),"OUTGOING_CALL_BARRED"==b.cdrResponseArray[i].hangup_cause&&(b.cdrDetail.unshift({date:h,call_answered:1,call_missed:0,voice_mail:0,outbound_call:1}),b.TotalCalls=b.TotalCalls+1),b.cdrDetailDates.unshift(h)))}}else if(b.phnNumbers==b.cdrResponseArray[i].dialed_number&&h==l){var m=b.cdrDetailDates.indexOf(l);m>-1?""!=b.cdrResponseArray[i].other_leg_call_id&&b.cdrResponseArray[i].other_leg_call_id.indexOf("@")>-1&&(b.cdrResponseArray[i].callee_id_number.match(/[a-z]/i)||"outbound"==b.cdrResponseArray[i].direction&&("NORMAL_CLEARING"==b.cdrResponseArray[i].hangup_cause&&(b.cdrDetail[m].call_answered=b.cdrDetail[m].call_answered+1,b.TotalCalls=b.TotalCalls+1),("ORIGINATOR_CANCEL"==b.cdrResponseArray[i].hangup_cause||"UNALLOCATED_NUMBER"==b.cdrResponseArray[i].hangup_cause||"CALL_REJECTED"==b.cdrResponseArray[i].hangup_cause||"NO_ANSWER"==b.cdrResponseArray[i].hangup_cause||"NO_USER_RESPONSE"==b.cdrResponseArray[i].hangup_cause||"RECOVERY_ON_TIME_EXPIRE"==b.cdrResponseArray[i].hangup_cause)&&(b.cdrDetail[m].call_missed=b.cdrDetail[m].call_missed+1,b.TotalCalls=b.TotalCalls+1),"OUTGOING_CALL_BARRED"==b.cdrResponseArray[i].hangup_cause&&(b.cdrDetail[m].outbound_call=b.cdrDetail[m].outbound_call+1,b.TotalCalls=b.TotalCalls+1))):""!=b.cdrResponseArray[i].other_leg_call_id&&b.cdrResponseArray[i].other_leg_call_id.indexOf("@")>-1&&(b.cdrResponseArray[i].callee_id_number.match(/[a-z]/i)||"outbound"==b.cdrResponseArray[i].direction&&("NORMAL_CLEARING"==b.cdrResponseArray[i].hangup_cause&&(b.cdrDetail.unshift({date:h,call_answered:1,call_missed:0,voice_mail:0,outbound_call:0}),b.TotalCalls=b.TotalCalls+1),("ORIGINATOR_CANCEL"==b.cdrResponseArray[i].hangup_cause||"UNALLOCATED_NUMBER"==b.cdrResponseArray[i].hangup_cause||"CALL_REJECTED"==b.cdrResponseArray[i].hangup_cause||"NO_ANSWER"==b.cdrResponseArray[i].hangup_cause||"NO_USER_RESPONSE"==b.cdrResponseArray[i].hangup_cause||"RECOVERY_ON_TIME_EXPIRE"==b.cdrResponseArray[i].hangup_cause)&&(b.cdrDetail.unshift({date:h,call_answered:0,call_missed:1,voice_mail:0,outbound_call:0}),b.TotalCalls=b.TotalCalls+1),"OUTGOING_CALL_BARRED"==b.cdrResponseArray[i].hangup_cause&&(b.cdrDetail.unshift({date:h,call_answered:1,call_missed:0,voice_mail:0,outbound_call:1}),b.TotalCalls=b.TotalCalls+1),b.cdrDetailDates.unshift(h)))}}-1==b.cdrDetailDates.indexOf(h)&&(b.cdrDetail.unshift({date:h,call_answered:0,call_missed:0,voice_mail:0,outbound_call:0,dates:h}),b.cdrDetailDates.unshift(h))}else b.cdrDetail.unshift({date:h,call_answered:0,call_missed:0,voice_mail:0,outbound_call:0,dates:h}),b.cdrDetailDates.unshift(h)}for(var n=0;n<b.cdrDetail.length;n++)b.cdrDetail[n].date=b.cdrDetail[n].date.split(" ");var o=864e5,p=new Date(b.date_from),q=new Date(b.date_to),r=Math.round(Math.abs((p.getTime()-q.getTime())/o));b.AverageCallsPerDay=Math.round(b.TotalCalls/r),r>6&&30>r?b.typeOptions=[{name:"Days",value:"days",selected:"selected"},{name:"Weeks",value:"weeks"}]:r>28?b.typeOptions=[{name:"Days",value:"days",selected:"selected"},{name:"Weeks",value:"weeks"},{name:"Months",value:"month"}]:b.typeOptions=[{name:"Days",value:"days",selected:"selected"}],"weeks"==b.form&&b.getcdrsWeek(),"month"==b.form&&b.getcdrsMonth(),b.RecentCalls(),b.getVoiceMailBoxes()})},b.dwnldClass=function(a){return 0===a?"calldnwl1":"callTime"},b.timeSet=function(){setInterval(function(){b.RecentCalls()},6e4)},b.RecentCalls=function(){var a=Math.round((new Date).getTime()/1e3),c=a-86400,d=c+62167219200,e=a+62167219200+1e5,g={auth_token:b.auth_Id,created_from:d,created_to:e},h=f.one("accounts/"+b.account_Id+"/cdrs");h.data=g,h.get(g,{"X-AUTH-TOKEN":b.auth_Id}).then(function(a){b.recentCall=!1,b.recentCallOk=!0,document.getElementById("nocalls").style.display="none",document.getElementById("yescalls").style.display="block";var c=a.data;b.callsIn24Hrs=[];for(var d=0;d<c.length;d++)if(c[d].other_leg_call_id.indexOf("@")>-1)if(c[d].callee_id_number.match(/[a-z]/i));else if("outbound"==c[d].direction){var e=c[d].datetime.substr(10,6),f=c[d].datetime.substr(0,10),g=new Date(f);g.setHours(0,0,0,0);var h=g.toString().substr(0,15);h=h.split(" "),b.callsIn24Hrs.unshift({date:h[2]+" "+h[1]+","+h[3],type:c[d].hangup_cause,caller:c[d].caller_id_number,time:e,caller_number:c[d].callee_id_number,duration:c[d].billing_seconds,call_id:c[d].other_leg_call_id})}})},b.recentCdrs=function(){var a=new Date,c=a.getDate(),d=a.getMonth()+1,e=a.getFullYear(),f=new Date(a);f.setDate(a.getDate()-5);var g=f.getDate(),h=f.getMonth()+1,i=f.getFullYear();10>g&&(g="0"+g),10>h&&(h="0"+h);var j=h+"/"+g+"/"+i,a=d+"/"+c+"/"+e;b.date_to=a,b.date_from=j,b.getcdrs()},b.recentCdrs(),b.doLogin=function(){var a=b.username,d=b.password;c({url:"php-script/login.php",method:"GET",params:{username:a,password:d}}).success(function(a,c){if("success"==a.msg){for(var d=0,f=[];d<a.user_role_grant_detail.length;)f.push(a.user_role_grant_detail[d].module_name),d++;localStorage.setItem("nm",b.username),localStorage.setItem("md5",a.md5_credential),localStorage.setItem("role",a.user_role_grant_detail[0].user_role_id),b.kazooAuthentication(a.md5_credential,a.account_name,f)}else e.path("/login.html"),b.msg="Login Credentials are not valid"})},b.kazooAuthentication=function(a,c,d){var g={credentials:a,account_name:c},h=f.one("user_auth");h.data=g,h.put().then(function(a){"success"==a.status?(b.auth_Id=a.auth_token,b.account_Id=a.data.account_id,localStorage.setItem("auth",a.auth_token),localStorage.setItem("acc",a.data.account_id),localStorage.setItem("module",d),e.path("/dashboard.html"),location.reload(),b.getPhoneNumbers(),b.getCredits(),b.recentCdrs()):(b.msg="Login Credentials are not valid",e.path("/login.html"))})},b.getcdrsWeek=function(){for(var a=864e5,c=new Date(b.date_from),d=new Date(b.date_to),e=(Math.round(Math.abs((c.getTime()-d.getTime())/a)),[]);b.cdrDetail.length;)e.push(b.cdrDetail.splice(0,7));for(var f=0;f<e.length;f++){for(var g=0,h=0,i=0,j=0,k=0;k<e[f].length;k++){var l=e[f][0].date,m=e[f][e[f].length-1].date;g+=e[f][k].call_answered,h+=e[f][k].call_missed,i+=e[f][k].voice_mail,j+=e[f][k].outbound_call}if(l[1]==m[1]){var n={date:["",l[1]+"'"+l[3],l[2]+"-"+m[2],""],call_missed:h,call_answered:g,voice_mail:i,outbound_call:j};b.cdrDetail.push(n)}else{var n={date:["",l[1]+"'"+l[3]+"-"+m[1]+"'"+m[3],l[2]+"-"+m[2],""],call_missed:h,call_answered:g,voice_mail:i,outbound_call:j};b.cdrDetail.push(n)}}},b.getCallLogs=function(a,c){b.CallLogs=[];for(var d=a.join(" "),e=a[2]+" "+a[1]+","+a[3],f=0;f<b.cdrResponseArray.length;f++){var a=b.cdrResponseArray[f].datetime.substr(0,10),g=new Date(a);g.setHours(0,0,0,0);var h=b.cdrResponseArray[f].datetime.substr(10,6),i=g.toString().substr(0,15);"all"==b.phnNumbers?d==i&&("answered"==c?"NORMAL_CLEARING"==b.cdrResponseArray[f].hangup_cause&&b.cdrResponseArray[f].other_leg_call_id.indexOf("@")>-1&&(b.cdrResponseArray[f].callee_id_number.match(/[a-z]/i)||"outbound"==b.cdrResponseArray[f].direction&&(""==b.cdrResponseArray[f].callee_id_number?b.CallLogs.unshift({date:e,type:b.cdrResponseArray[f].hangup_cause,caller:b.cdrResponseArray[f].caller_id_number,caller_number:b.cdrResponseArray[f].calling_from,duration:b.cdrResponseArray[f].billing_seconds,total_duration:b.cdrResponseArray[f].duration_seconds,time:h,call_id:b.cdrResponseArray[f].other_leg_call_id}):b.CallLogs.unshift({date:e,type:b.cdrResponseArray[f].hangup_cause,caller:b.cdrResponseArray[f].caller_id_number,caller_number:b.cdrResponseArray[f].callee_id_number,duration:b.cdrResponseArray[f].billing_seconds,total_duration:b.cdrResponseArray[f].duration_seconds,time:h,call_id:b.cdrResponseArray[f].other_leg_call_id}))):"outbound"==c?"OUTGOING_CALL_BARRED"==b.cdrResponseArray[f].hangup_cause&&b.cdrResponseArray[f].other_leg_call_id.indexOf("@")>-1&&(b.cdrResponseArray[f].callee_id_number.match(/[a-z]/i)||"outbound"==b.cdrResponseArray[f].direction&&(""==b.cdrResponseArray[f].callee_id_number?b.CallLogs.unshift({date:e,type:b.cdrResponseArray[f].hangup_cause,caller:b.cdrResponseArray[f].caller_id_number,caller_number:b.cdrResponseArray[f].calling_from,duration:b.cdrResponseArray[f].billing_seconds,total_duration:b.cdrResponseArray[f].duration_seconds,time:h,call_id:b.cdrResponseArray[f].other_leg_call_id}):b.CallLogs.unshift({date:e,type:b.cdrResponseArray[f].hangup_cause,caller:b.cdrResponseArray[f].caller_id_number,caller_number:b.cdrResponseArray[f].callee_id_number,duration:b.cdrResponseArray[f].billing_seconds,total_duration:b.cdrResponseArray[f].duration_seconds,time:h,call_id:b.cdrResponseArray[f].other_leg_call_id}))):"missed"==c&&("ORIGINATOR_CANCEL"==b.cdrResponseArray[f].hangup_cause||"UNALLOCATED_NUMBER"==b.cdrResponseArray[f].hangup_cause||"NO_ANSWER"==b.cdrResponseArray[f].hangup_cause||"NO_USER_RESPONSE"==b.cdrResponseArray[f].hangup_cause||"CALL_REJECTED"==b.cdrResponseArray[f].hangup_cause||"RECOVERY_ON_TIME_EXPIRE"==b.cdrResponseArray[f].hangup_cause)&&b.cdrResponseArray[f].other_leg_call_id.indexOf("@")>-1&&(b.cdrResponseArray[f].callee_id_number.match(/[a-z]/i)||"outbound"==b.cdrResponseArray[f].direction&&(""==b.cdrResponseArray[f].callee_id_number?b.CallLogs.unshift({date:e,type:b.cdrResponseArray[f].hangup_cause,caller:b.cdrResponseArray[f].caller_id_number,caller_number:b.cdrResponseArray[f].calling_from,duration:b.cdrResponseArray[f].billing_seconds,total_duration:b.cdrResponseArray[f].duration_seconds,time:h,call_id:b.cdrResponseArray[f].other_leg_call_id}):b.CallLogs.unshift({date:e,type:b.cdrResponseArray[f].hangup_cause,caller:b.cdrResponseArray[f].caller_id_number,caller_number:b.cdrResponseArray[f].callee_id_number,duration:b.cdrResponseArray[f].billing_seconds,total_duration:b.cdrResponseArray[f].duration_seconds,time:h,call_id:b.cdrResponseArray[f].other_leg_call_id})))):b.phnNumbers==b.cdrResponseArray[f].dialed_number&&d==i&&("answered"==c?"NORMAL_CLEARING"==b.cdrResponseArray[f].hangup_cause&&b.cdrResponseArray[f].other_leg_call_id.indexOf("@")>-1&&(b.cdrResponseArray[f].callee_id_number.match(/[a-z]/i)||"outbound"==b.cdrResponseArray[f].direction&&(""==b.cdrResponseArray[f].callee_id_number?b.CallLogs.unshift({date:e,type:b.cdrResponseArray[f].hangup_cause,caller:b.cdrResponseArray[f].caller_id_number,caller_number:b.cdrResponseArray[f].calling_from,duration:b.cdrResponseArray[f].billing_seconds,total_duration:b.cdrResponseArray[f].duration_seconds,time:h,call_id:b.cdrResponseArray[f].other_leg_call_id}):b.CallLogs.unshift({date:e,type:b.cdrResponseArray[f].hangup_cause,caller:b.cdrResponseArray[f].caller_id_number,caller_number:b.cdrResponseArray[f].callee_id_number,duration:b.cdrResponseArray[f].billing_seconds,total_duration:b.cdrResponseArray[f].duration_seconds,time:h,call_id:b.cdrResponseArray[f].other_leg_call_id}))):"missed"==c?("ORIGINATOR_CANCEL"==b.cdrResponseArray[f].hangup_cause||"NO_ANSWER"==b.cdrResponseArray[f].hangup_cause||"NO_USER_RESPONSE"==b.cdrResponseArray[f].hangup_cause||"CALL_REJECTED"==b.cdrResponseArray[f].hangup_cause||"RECOVERY_ON_TIME_EXPIRE"==b.cdrResponseArray[f].hangup_cause)&&b.cdrResponseArray[f].other_leg_call_id.indexOf("@")>-1&&(b.cdrResponseArray[f].callee_id_number.match(/[a-z]/i)||"outbound"==b.cdrResponseArray[f].direction&&(""==b.cdrResponseArray[f].callee_id_number?b.CallLogs.unshift({date:e,type:b.cdrResponseArray[f].hangup_cause,caller:b.cdrResponseArray[f].caller_id_number,caller_number:b.cdrResponseArray[f].calling_from,duration:b.cdrResponseArray[f].billing_seconds,total_duration:b.cdrResponseArray[f].duration_seconds,time:h,call_id:b.cdrResponseArray[f].other_leg_call_id}):b.CallLogs.unshift({date:e,type:b.cdrResponseArray[f].hangup_cause,caller:b.cdrResponseArray[f].caller_id_number,caller_number:b.cdrResponseArray[f].callee_id_number,duration:b.cdrResponseArray[f].billing_seconds,total_duration:b.cdrResponseArray[f].duration_seconds,time:h,call_id:b.cdrResponseArray[f].other_leg_call_id}))):"outbound"==c&&"OUTGOING_CALL_BARRED"==b.cdrResponseArray[f].hangup_cause&&b.cdrResponseArray[f].other_leg_call_id.indexOf("@")>-1&&(b.cdrResponseArray[f].callee_id_number.match(/[a-z]/i)||"outbound"==b.cdrResponseArray[f].direction&&(""==b.cdrResponseArray[f].callee_id_number?b.CallLogs.unshift({date:e,type:b.cdrResponseArray[f].hangup_cause,caller:b.cdrResponseArray[f].caller_id_number,caller_number:b.cdrResponseArray[f].calling_from,duration:b.cdrResponseArray[f].billing_seconds,total_duration:b.cdrResponseArray[f].duration_seconds,time:h,call_id:b.cdrResponseArray[f].other_leg_call_id}):b.CallLogs.unshift({date:e,type:b.cdrResponseArray[f].hangup_cause,caller:b.cdrResponseArray[f].caller_id_number,caller_number:b.cdrResponseArray[f].callee_id_number,duration:b.cdrResponseArray[f].billing_seconds,total_duration:b.cdrResponseArray[f].duration_seconds,time:h,call_id:b.cdrResponseArray[f].other_leg_call_id}))))}},b.getcdrsMonth=function(){var a=864e5,c=new Date(b.date_from),d=new Date(b.date_to),e=b.date_from.substring(3,5),f=b.date_from.substring(0,2),g=parseInt(e);if("01"==f||"03"==f||"05"==f||"07"==f||"08"==f||"10"==f||"12"==f)var h=31-(g-1);else if("04"==f||"06"==f||"09"==f||"11"==f)var h=30-(g-1);else var h=28-(g-1);for(var i=(Math.round(Math.abs((c.getTime()-d.getTime())/a)),[]);b.cdrDetail.length;)i.push(b.cdrDetail.splice(0,h));for(var j=0;j<=i.length;j++){for(var k=0,l=0,m=0,n=0,o=0;o<i[j].length;o++){var p=i[j][0].date,q=i[j][i[j].length-1].date;k+=i[j][o].call_answered,l+=i[j][o].call_missed,m+=i[j][o].voice_mail,n+=i[j][o].outbound_call}var r={date:["",p[1]+"'"+p[3],p[2]+"-"+q[2],""],call_missed:l,call_answered:k,voice_mail:m,outbound_call:n};b.cdrDetail.push(r)}},b.show_dateOptions=function(){b.dateBlock=!0},b.hide_dateOptions=function(){b.dateBlock=!1},b.exportData=function(){var a=b.cdrResponseArray;if("csv"==b.export_as){for(var c=[["id","call_id, caller_id_number, caller_id_name, callee_id_number, callee_id_name, duration_seconds, billing_seconds, timestamp, hangup_cause, other_leg_call_id, owner_id, to, from, direction, request, authorizing_id, cost, dialed_number, calling_from, datetime, unix_timestamp, call_type, rate, rate_name, reseller_call_type, reseller_cost"]],d=1;d<a.length;++d)c.push([a[d].id,a[d].call_id,a[d].caller_id_number,a[d].caller_id_name,a[d].callee_id_number,a[d].callee_id_name,a[d].duration_seconds,a[d].billing_seconds,a[d].timestamp,a[d].hangup_cause,a[d].other_leg_call_id,a[d].owner_id,a[d].to,a[d].from,a[d].direction,a[d].request,a[d].authorizing_id,a[d].cost,a[d].dialed_number,a[d].calling_from,a[d].datetime,a[d].unix_timestamp,a[d].call_type,a[d].rate,a[d].rate_name,a[d].reseller_call_type,a[d].reseller_cost]);for(var e=[],f=0,g=c.length;g>f;++f)e.push(c[f].join(","));var h=e.join("%0A"),i=document.createElement("a");i.href="data:attachment/csv,"+h,i.target="_blank",i.download="myFile.csv",document.body.appendChild(i),i.click()}else"excel"==b.export_as&&alasql('SELECT * INTO XLSX("john.xlsx",{headers:true}) FROM ?',[b.cdrResponseArray])}}]),MetronicApp.directive("datepickerfrom",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.datepicker({dateFormat:"mm/dd/yy",maxDate:"0",onSelect:function(b){a.date_from=b,a.$apply()}})}}}),MetronicApp.directive("datepickerto",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.datepicker({dateFormat:"mm/dd/yy",maxDate:"0",onSelect:function(b){a.date_to=b,a.$apply()}})}}}),MetronicApp.directive("modalDialog",function(){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,link:function(a,b,c){a.dialogStyle={},c.width&&(a.dialogStyle.width=c.width),c.height&&(a.dialogStyle.height=c.height),a.hideModal=function(){a.show=!1}},template:"<div class='ng-modal' ng-show='show'><div class='ng-modal-overlay' ng-click='hideModal()'></div><div class='ng-modal-dialog' ng-style='dialogStyle'><!--<div class='ng-modal-close' ng-click='hideModal()'><img src ='../images/close_icon.png'/>X</div>--><div class='ng-modal-dialog-content' ng-transclude></div></div></div>"}}),MetronicApp.directive("dateBlock",function(){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,link:function(a,b,c){a.dialogStyle={},c.width&&(a.dialogStyle.width=c.width),c.height&&(a.dialogStyle.height=c.height),a.hideModal=function(){a.show=!1}},template:"<div class='ng-modal' ng-show='show'><div class='ng-modal-overlay' ng-click='hideModal()'></div><div class='ng-modal-dialog' style='height:200px;width:400px;left:70%;top:52%;'><div class='ng-modal-dialog-content' ng-transclude></div></div></div>"}});